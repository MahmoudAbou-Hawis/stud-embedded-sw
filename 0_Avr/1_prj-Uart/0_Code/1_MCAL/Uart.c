/******************************************************************************/
/**
 * @file Uart.c
 * @brief Uart protocol implemention in c language 
 *
 * @par Project Name
 * Uart Project
 *
 * @par Code Language
 * C
 *
 * @par Description
 * You can Transmit and receive with Uart protocol
 * 
 * @par Author
 * Mahmoud Abou-Hawis
 *
 */
/******************************************************************************/

/******************************************************************************/
/* INCLUDES */
/******************************************************************************/

#include "Uart.h"
#include "StdTypes.h"

/******************************************************************************/

/******************************************************************************/
/* PRIVATE DEFINES */
/******************************************************************************/
#define UART0_BASE (0xC0)
#define TR_UART0 ((tstUartHandle *)UART0_BASE)

/******************************************************************************/

/******************************************************************************/
/* PRIVATE MACROS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PRIVATE ENUMS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PRIVATE TYPES */
/******************************************************************************/

typedef struct
{
    volatile uint8 u8UcsrA;
    volatile uint8 u8UcsrB;
    volatile uint8 u8UcsrC;
    volatile uint8 u8Dummy1;
    volatile uint16 u16Ubrr;
    volatile uint8 u8Udr;

} tstUartHandle;

/******************************************************************************/

/******************************************************************************/
/* PRIVATE CONSTANT DEFINITIONS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PRIVATE VARIABLE DEFINITIONS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PUBLIC CONSTANT DEFINITIONS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PUBLIC VARIABLE DEFINITIONS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PRIVATE FUNCTION PROTOTYPES */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PRIVATE FUNCTION DEFINITIONS */
/******************************************************************************/

/******************************************************************************/

/******************************************************************************/
/* PUBLIC FUNCTION DEFINITIONS */
/******************************************************************************/

void UART_vInit(void)
{
    TR_UART0->u16Ubrr = ((F_CLK / (16 * (uint32)9600)) - 1);
    TR_UART0->u8UcsrB |= (1 << 3) | (1 << 4);
    TR_UART0->u8UcsrC |= (3 << 1);
}

void UART_vTransmitByte(uint8 Byte)
{
    while (!(TR_UART0->u8UcsrA & (1 << 5)));
    TR_UART0->u8Udr = Byte;
}

uint8 UART_u8ReceiveByte(void)
{
    while (!(TR_UART0->u8UcsrA & (1 << 7)));
    return TR_UART0->u8Udr;
}

/******************************************************************************/